# ğŸ› ï¸ Git Automation: Clone, Create Branch, and Push to Multiple Repositories

This set of Bash scripts automates the process of:

1. Cloning multiple repositories from a list.  
2. Creating (or updating) a new branch called `new-prod` based on the main branch.  
3. Pushing that new branch to remote repositories.

---

## ğŸ“‚ Script Structure

### 1. `cloneRepos.sh`

Clones multiple repositories at once.

#### ğŸ”§ Usage

```bash
# Using a file with URLs (e.g., repos.txt)
./cloneRepos.sh -f repos.txt

# Using arguments directly
./cloneRepos.sh https://example.com/repo1.git https://example.com/repo2.git

# Using stdin input
cat repos.txt | ./cloneRepos.sh
```

#### ğŸ” Notes

- The `repos.txt` file should contain one URL per line.
- Already cloned repositories (folders already exist) will be automatically skipped.
- Performs a shallow clone of the `main` branch using `--depth=1`.

---

### 2. `createBranchs.sh`

Creates (or recreates) a new branch called `new-prod` based on the remote main branch (`main`).

#### ğŸ”§ Usage

```bash
# Using the log generated by the clone step:
grep -oP 'â†’\s+\K[^\s/]+' clone.log | sort -u | xargs ./createBranchs.sh
```

#### ğŸ” Notes

- Assumes all repositories are in the current directory.
- By default, uses the `main` branch as the base (can be changed in the script).
- Updates remote references before creating the branch.
- Uses `git switch -C` to create or overwrite the local branch based on `origin/main`.

---

### 3. `pushToOrigin.sh`

Pushes the `new-prod` branch to the remote repository.

#### ğŸ”§ Usage

```bash
grep -oP 'â†’\s+\K[^\s/]+' clone.log | sort -u | xargs ./pushToOrigin.sh
```

#### ğŸ” Notes

- Skips repositories where the `new-prod` branch does not yet exist.
- Uses `git push -u origin new-prod` to create the remote branch and set the upstream.

---

## ğŸ“‹ Recommended Execution Order

```bash
# 1. Clone the repositories
./cloneRepos.sh -f repos.txt > clone.log

# 2. Create new-prod branches locally
grep -oP 'â†’\s+\K[^\s/]+' clone.log | sort -u | xargs ./createBranchs.sh

# 3. Push those branches to the remote
grep -oP 'â†’\s+\K[^\s/]+' clone.log | sort -u | xargs ./pushToOrigin.sh
```

---

## ğŸ“ Example `repos.txt`

```txt
https://dev.azure.com/myorg/_git/alerts-api
https://dev.azure.com/myorg/_git/equipment-service
# Comments and blank lines are ignored
```

---

## âœ… Requirements

- `git` installed and authenticated with access to the remote repositories.
- `bash` (tested in Unix/Linux environments).
- Permission to create and push branches to the repositories.

---

## ğŸ’¡ Tip

You can change the branch name by modifying the `NEW_BRANCH` variable in both `createBranchs.sh` and `pushToOrigin.sh`.